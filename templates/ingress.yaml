apiVersion: argoproj.io/v1alpha1
kind: WorkflowTemplate
metadata:
  name: create-ingress-wt
spec:
  entrypoint: create-ingress
  arguments:
    parameters:
      - name: oas
      - name: ingress
      - name: service
      - name: branch
  templates:
    - name: create-ingress
      inputs:
        artifacts:
          - name: apis
            path: /workspace
            git:
              repo: https://github.com/apirator/workflow-api-docs.git
              revision: "{{arguments.parameters.branch}}"
      arguments:
        parameters:
          - name: oas
          - name: ingress
          - name: service
          - name: branch
      container:
        image: claudioed/openapitokongingress
        command: [oas2ingress,convert]
        args: ["--oas","{{arguments.parameters.oas}}","--ingress","{{arguments.parameters.ingress}}","--service","{{arguments.parameters.service}}"]
      outputs:
        artifacts:
          - name: ingress
            path: "/tmp/{{arguments.parameters.service}}.yaml"
            archive:
              none: {}
            gcs:
              bucket: argo-artifacts-001
              key: "ingresses/{{arguments.parameters.service}}.yaml"
              serviceAccountKeySecret:
                name: argo-artifact
                key: argo-development-319710-04e977a95f95.json
